---
import Layout from '../../layouts/Layout.astro';
import AlbumCard from '../../components/AlbumCard.astro';
import { homeUrl } from '../../lib/urls';

export function getStaticPaths() {
  const categoryModules = Object.values(
    import.meta.glob('/src/content/categories/*.json', { eager: true })
  );

  return categoryModules.map((module: any) => ({
    params: { id: module.default.id },
    props: { category: module.default },
  }));
}

const { category } = Astro.props;

const albumModules = Object.values(
  import.meta.glob('/src/content/albums/*.json', { eager: true })
);

const albums = albumModules
  .map((module: any) => module.default)
  .filter((album) => album.category === category.id)
  .sort((a, b) => b.date.localeCompare(a.date));
---

{!category ? (
  <Layout title="Категория не найдена">
    <div class="container mx-auto px-6 md:px-12 py-20 text-center">
      <h1 class="text-4xl font-light mb-4" style="font-family: var(--font-serif);">
        Категория не найдена
      </h1>
      <a href={homeUrl()} class="text-text-secondary hover:text-white transition-colors">
        ← Вернуться на главную
      </a>
    </div>
  </Layout>
) : (
  <Layout title={`${category.title} — Portfolio`}>
    <div class="container mx-auto px-6 md:px-12 py-12">
      <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="mb-12 animate-fade-in">
          <a 
            href={homeUrl()}
            class="inline-flex items-center gap-2 text-text-secondary hover:text-white transition-colors duration-300 mb-8"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <line x1="19" y1="12" x2="5" y2="12"></line>
              <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
            <span class="text-sm tracking-wide">Все работы</span>
          </a>

          <h1 class="text-4xl md:text-5xl lg:text-6xl font-light mb-4" style="font-family: var(--font-serif);">
            {category.title}
          </h1>

          {category.description && (
            <p class="text-text-secondary text-lg max-w-2xl mb-4">
              {category.description}
            </p>
          )}

          <p class="text-sm text-text-secondary/60">
            {albums.length} {albums.length === 1 ? 'альбом' : albums.length < 5 ? 'альбома' : 'альбомов'}
          </p>
        </header>

        <!-- Albums grid -->
        {albums.length > 0 ? (
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
            {albums.map((album) => (
              <AlbumCard album={album} />
            ))}
          </div>
        ) : (
          <div class="text-center py-20">
            <p class="text-text-secondary">
              В этой категории пока нет альбомов.
            </p>
          </div>
        )}
      </div>
    </div>
  </Layout>
)}
