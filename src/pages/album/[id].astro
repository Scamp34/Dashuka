---
import Layout from '../../layouts/Layout.astro';
import PhotoGrid from '../../components/PhotoGrid.astro';
import Lightbox from '../../components/Lightbox.astro';
import { categoryUrl, homeUrl } from '../../lib/urls';

export function getStaticPaths() {
  const albumModules = Object.values(
    import.meta.glob('/src/content/albums/*.json', { eager: true })
  );

  return albumModules.map((module: any) => ({
    params: { id: module.default.id },
    props: { album: module.default },
  }));
}

const { album } = Astro.props;

const categoryModules = Object.values(
  import.meta.glob('/src/content/categories/*.json', { eager: true })
) as any[];
const category = categoryModules.find(
  (module) => module.default.id === album.category
)?.default;
---

{!album ? (
  <Layout title="Альбом не найден">
    <div class="container mx-auto px-6 md:px-12 py-20 text-center">
      <h1 class="text-4xl font-light mb-4" style="font-family: var(--font-serif);">
        Альбом не найден
      </h1>
      <a href={homeUrl()} class="text-text-secondary hover:text-white transition-colors">
        ← Вернуться на главную
      </a>
    </div>
  </Layout>
) : (
  <Layout title={`${album.title} — Portfolio`}>
    <div class="container mx-auto px-6 md:px-12 py-12">
      <div class="max-w-7xl mx-auto">
        <!-- Header with back link -->
        <header class="mb-12 animate-fade-in">
          <!-- Back navigation -->
          <a 
            href={category ? categoryUrl(category.id) : homeUrl()}
            class="inline-flex items-center gap-2 text-text-secondary hover:text-white transition-colors duration-300 mb-8"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <line x1="19" y1="12" x2="5" y2="12"></line>
              <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
            <span class="text-sm tracking-wide">
              {category ? category.title : 'Все работы'}
            </span>
          </a>

          <!-- Album title -->
          <h1 class="text-4xl md:text-5xl lg:text-6xl font-light mb-4" style="font-family: var(--font-serif);">
            {album.title}
          </h1>

          {album.description && (
            <p class="text-text-secondary text-lg max-w-2xl mb-4">
              {album.description}
            </p>
          )}

          <p class="text-sm text-text-secondary/60">
            {new Date(album.date).toLocaleDateString('ru-RU', {
              year: 'numeric',
              month: 'long',
              day: 'numeric',
            })}
            {album.photos && (
              <span class="ml-4">{album.photos.length} фото</span>
            )}
          </p>
        </header>

        <!-- Photo grid -->
        {album.photos && album.photos.length > 0 ? (
          <>
            <PhotoGrid photos={album.photos} albumTitle={album.title} />
            <Lightbox photos={album.photos} />
          </>
        ) : (
          <div class="text-center py-20">
            <p class="text-text-secondary">
              В этом альбоме пока нет фотографий.
            </p>
          </div>
        )}
      </div>
    </div>
  </Layout>
)}
