---
// WHY PhotoGrid.astro: Masonry-style photo grid with Peter Beavis hover effects
import { withBase } from '../lib/urls';

interface Props {
	photos: string[];
	albumTitle: string;
}

const { photos, albumTitle } = Astro.props;
const photosWithBase = photos.map(photo => withBase(photo));
---

<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
	{
		photosWithBase.map((photo, index) => (
			<div 
				class="stagger-item group relative overflow-hidden cursor-pointer"
				style={`animation-delay: ${index * 75}ms`}
			>
				<div class="aspect-[4/3] overflow-hidden bg-white/5">
					<img
						src={photo}
						alt={`${albumTitle} — фото ${index + 1}`}
						loading="lazy"
						decoding="async"
						data-index={index}
						class="w-full h-full object-cover transition-transform duration-700 ease-out group-hover:scale-105"
					/>
				</div>
				
				<!-- WHY: Subtle overlay on hover -->
				<div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors duration-500 pointer-events-none"></div>
			</div>
		))
	}
</div>

<script is:inline define:vars={{ photos: photosWithBase }}>
	const handleClick = (index) => {
		const event = new CustomEvent('open-lightbox', {
			detail: { index, photos }
		});
		window.dispatchEvent(event);
	};

	document.querySelectorAll('img[data-index]').forEach((img) => {
		img.addEventListener('click', () => {
			const index = parseInt(img.getAttribute('data-index') || '0');
			handleClick(index);
		});
	});
</script>
