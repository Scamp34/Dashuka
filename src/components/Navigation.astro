---
// WHY Navigation.astro: Minimal navigation inspired by Peter Beavis
// Fixed header with mix-blend-difference for elegant contrast
import { withBase, stripBase, categoryUrl, homeUrl } from '../lib/urls';

const categories = Object.values(
  import.meta.glob('/src/content/categories/*.json', { eager: true })
).map((module: any) => module.default);

const currentPath = stripBase(Astro.url.pathname);
---

<nav class="py-6 px-6 md:px-12">
	<div class="max-w-7xl mx-auto flex items-center justify-between">
		<!-- Logo / Site Name -->
		<a 
			href={homeUrl()} 
			class="text-lg font-light tracking-wider text-white hover:opacity-70 transition-opacity duration-300"
			style="font-family: var(--font-serif);"
		>
			Portfolio
		</a>

		<!-- Desktop Navigation -->
		<ul class="hidden md:flex items-center gap-8">
			<li>
				<a
					href={homeUrl()}
					class:list={[
						'text-sm tracking-wide transition-opacity duration-300',
						currentPath === '/' ? 'text-white' : 'text-white/60 hover:text-white'
					]}
				>
					Все
				</a>
			</li>
			{categories.map((category) => (
				<li>
					<a
						href={categoryUrl(category.id)}
						class:list={[
							'text-sm tracking-wide transition-opacity duration-300',
							currentPath === `/category/${category.id}` ? 'text-white' : 'text-white/60 hover:text-white'
						]}
					>
						{category.title}
					</a>
				</li>
			))}
		</ul>

		<!-- Mobile Menu Button -->
		<button
			id="nav-menu-button"
			class="md:hidden text-white p-2"
			aria-expanded="false"
			aria-controls="nav-menu"
			aria-label="Меню"
		>
			<svg
				id="nav-menu-icon"
				xmlns="http://www.w3.org/2000/svg"
				width="24"
				height="24"
				viewBox="0 0 24 24"
				fill="none"
				stroke="currentColor"
				stroke-width="1.5"
				stroke-linecap="round"
				stroke-linejoin="round"
				class="transition-transform duration-300"
			>
				<line x1="4" y1="8" x2="20" y2="8" class="origin-center transition-all duration-300" id="line1"></line>
				<line x1="4" y1="16" x2="20" y2="16" class="origin-center transition-all duration-300" id="line2"></line>
			</svg>
		</button>
	</div>

	<!-- Mobile Menu Overlay -->
	<div
		id="nav-menu"
		class="fixed inset-0 bg-background/98 backdrop-blur-sm z-50 hidden flex-col items-center justify-center"
	>
		<button
			id="nav-menu-close"
			class="absolute top-6 right-6 text-white p-2"
			aria-label="Закрыть меню"
		>
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
				<line x1="18" y1="6" x2="6" y2="18"></line>
				<line x1="6" y1="6" x2="18" y2="18"></line>
			</svg>
		</button>

		<ul class="flex flex-col items-center gap-8">
			<li>
				<a
					href={homeUrl()}
					class="text-2xl font-light tracking-wide text-white hover:opacity-70 transition-opacity"
					style="font-family: var(--font-serif);"
				>
					Все работы
				</a>
			</li>
			{categories.map((category) => (
				<li>
					<a
						href={categoryUrl(category.id)}
						class="text-2xl font-light tracking-wide text-white hover:opacity-70 transition-opacity"
						style="font-family: var(--font-serif);"
					>
						{category.title}
					</a>
				</li>
			))}
		</ul>
	</div>
</nav>

<script>
	const menuButton = document.getElementById('nav-menu-button');
	const menuClose = document.getElementById('nav-menu-close');
	const menu = document.getElementById('nav-menu');

	if (menuButton && menuClose && menu) {
		function openMenu() {
			menu.classList.remove('hidden');
			menu.classList.add('flex');
			document.body.style.overflow = 'hidden';
			menuButton.setAttribute('aria-expanded', 'true');
		}

		function closeMenu() {
			menu.classList.add('hidden');
			menu.classList.remove('flex');
			document.body.style.overflow = '';
			menuButton.setAttribute('aria-expanded', 'false');
		}

		menuButton.addEventListener('click', openMenu);
		menuClose.addEventListener('click', closeMenu);

		// Close on link click
		menu.querySelectorAll('a').forEach((link) => {
			link.addEventListener('click', closeMenu);
		});

		// Close on Escape key
		document.addEventListener('keydown', (e) => {
			if (e.key === 'Escape' && !menu.classList.contains('hidden')) {
				closeMenu();
			}
		});
	}
</script>
